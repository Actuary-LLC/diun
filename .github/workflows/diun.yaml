name: 'diun'
on:
  workflow_dispatch:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: [self-hosted]
    env:
      DIUN_NOTIF_DISCORD_WEBHOOKURL: ${{ secrets.DIUN_NOTIF_DISCORD_WEBHOOKURL }}
      TAG: ${{ github.sha }}
    steps:
      - name: Configure application
        run: |
          sed -i 's/${DIUN_NOTIF_DISCORD_WEBHOOKURL}/${{ secrets.DIUN_NOTIF_DISCORD_WEBHOOKURL }}/' config.yaml
          cat config.yaml
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Run a container command
        run: |
          docker stack deploy -c diun.yaml diun
